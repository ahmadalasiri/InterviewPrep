# Caching Strategies Configuration
# Performance optimization through caching

http {
    # Proxy cache
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=main_cache:50m 
                     max_size=10g inactive=60m use_temp_path=off;
    
    # Open file cache (cache file metadata)
    open_file_cache max=10000 inactive=30s;
    open_file_cache_valid 60s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
    
    upstream backend {
        server 127.0.0.1:8080;
    }
    
    server {
        listen 80;
        server_name example.com;
        
        # Static files with browser caching
        location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2)$ {
            root /var/www/html;
            expires 1y;
            add_header Cache-Control "public, immutable";
            access_log off;
        }
        
        # API with proxy cache
        location /api/ {
            proxy_pass http://backend;
            proxy_cache main_cache;
            proxy_cache_valid 200 10m;
            proxy_cache_key "$scheme$host$request_uri";
            add_header X-Cache-Status $upstream_cache_status;
        }
        
        # Dynamic content - no cache
        location / {
            root /var/www/html;
            try_files $uri $uri/ =404;
        }
    }
}

# Caching Strategies:
# - Browser cache: Long TTL for static assets
# - Proxy cache: Cache backend responses
# - Open file cache: Cache file metadata
# - CDN: Use CDN for global distribution

