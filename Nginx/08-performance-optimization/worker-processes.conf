# Worker Processes Optimization
# Optimizing Nginx worker configuration

# Main context
user nginx;
worker_processes auto;  # Automatically set to CPU cores
# worker_processes 4;  # Or specify explicitly

# Bind workers to CPU cores (Linux)
worker_cpu_affinity auto;
# worker_cpu_affinity 0001 0010 0100 1000;  # Manual binding

error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    # Max connections per worker
    worker_connections 2048;  # Adjust based on system
    
    # Use efficient event method
    use epoll;  # Linux
    # use kqueue;  # BSD/macOS
    
    # Accept multiple connections at once
    multi_accept on;
}

http {
    # Max connections = worker_processes × worker_connections
    # Example: 4 workers × 2048 = 8,192 connections
    
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # Performance optimizations
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    server {
        listen 80;
        server_name example.com;
        root /var/www/html;
        
        location / {
            try_files $uri $uri/ =404;
        }
    }
}

