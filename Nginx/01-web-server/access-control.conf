# Access Control Configuration
# IP-based and authentication-based access control

# IP Whitelisting
server {
    listen 80;
    server_name example.com;
    root /var/www/example.com;
    
    # Admin area - IP whitelist only
    location /admin/ {
        allow 192.168.1.100;
        allow 10.0.0.0/8;
        deny all;
        
        try_files $uri $uri/ =404;
    }
    
    # API - IP whitelist
    location /api/ {
        allow 192.168.1.0/24;
        deny all;
        
        proxy_pass http://127.0.0.1:8080;
    }
    
    # Public area
    location / {
        allow all;
        try_files $uri $uri/ =404;
    }
}

# HTTP Basic Authentication
server {
    listen 80;
    server_name secure.example.com;
    root /var/www/secure;
    
    # Protected area with authentication
    location /private/ {
        auth_basic "Restricted Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
        
        try_files $uri $uri/ =404;
    }
    
    # Combined: IP whitelist + authentication
    location /secure/ {
        # IP whitelist
        allow 192.168.1.0/24;
        deny all;
        
        # HTTP authentication
        auth_basic "Secure Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
        
        try_files $uri $uri/ =404;
    }
}

# To create password file:
# sudo apt install apache2-utils
# sudo htpasswd -c /etc/nginx/.htpasswd username

