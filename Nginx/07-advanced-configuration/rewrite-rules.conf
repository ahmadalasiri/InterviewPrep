# URL Rewriting and Redirects Configuration
# Rewrite rules and redirects

server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    
    # Permanent redirect (301)
    location /old-page {
        return 301 /new-page;
    }
    
    # Temporary redirect (302)
    location /temp {
        return 302 /temporary;
    }
    
    # Rewrite with break
    location /api/ {
        rewrite ^/api/(.*)$ /$1 break;
        proxy_pass http://127.0.0.1:8080;
    }
    
    # Rewrite with last
    location /blog/ {
        rewrite ^/blog/(.*)$ /posts/$1 last;
    }
    
    # Remove trailing slash
    location / {
        rewrite ^/(.*)/$ /$1 permanent;
        try_files $uri $uri/ =404;
    }
    
    # Force HTTPS
    if ($scheme != "https") {
        return 301 https://$server_name$request_uri;
    }
    
    # Remove www
    if ($host ~* ^www\.(.*)$) {
        return 301 $scheme://$1$request_uri;
    }
}

# Rewrite Flags:
# - last: Stop processing and search for new location
# - break: Stop processing in current location
# - redirect: 302 temporary redirect
# - permanent: 301 permanent redirect

