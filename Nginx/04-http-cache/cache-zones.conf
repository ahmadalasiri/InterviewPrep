# Multiple Cache Zones Configuration
# Different cache zones for different content types

http {
    # Static content cache (long TTL)
    proxy_cache_path /var/cache/nginx/static levels=1:2 keys_zone=static_cache:50m 
                     max_size=5g inactive=7d use_temp_path=off;
    
    # API cache (short TTL)
    proxy_cache_path /var/cache/nginx/api levels=1:2 keys_zone=api_cache:10m 
                     max_size=1g inactive=1h use_temp_path=off;
    
    upstream backend {
        server 127.0.0.1:8080;
    }
    
    server {
        listen 80;
        server_name example.com;
        
        # Static content - long cache
        location /static/ {
            proxy_pass http://backend;
            proxy_cache static_cache;
            proxy_cache_valid 200 7d;
            proxy_cache_key "$scheme$host$request_uri";
            add_header X-Cache-Status $upstream_cache_status;
        }
        
        # API - short cache
        location /api/ {
            proxy_pass http://backend;
            proxy_cache api_cache;
            proxy_cache_valid 200 5m;
            proxy_cache_key "$scheme$host$request_uri$is_args$args";
            
            # Bypass for authenticated requests
            proxy_cache_bypass $http_authorization;
            proxy_no_cache $http_authorization;
            
            add_header X-Cache-Status $upstream_cache_status;
        }
        
        # Dynamic content - no cache
        location /admin/ {
            proxy_pass http://backend;
            proxy_cache_bypass 1;
            proxy_no_cache 1;
        }
    }
}

