# Cache Invalidation Configuration
# Methods to purge and invalidate cached content

http {
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m 
                     max_size=10g inactive=60m use_temp_path=off;
    
    # Map for cache purge method
    map $request_method $purge_method {
        PURGE 1;
        default 0;
    }
    
    upstream backend {
        server 127.0.0.1:8080;
    }
    
    server {
        listen 80;
        server_name example.com;
        
        location / {
            proxy_pass http://backend;
            proxy_cache my_cache;
            proxy_cache_valid 200 60m;
            
            # Cache purge
            proxy_cache_purge $purge_method;
            
            add_header X-Cache-Status $upstream_cache_status;
        }
        
        # Cache purge endpoint (requires ngx_cache_purge module)
        location ~ /purge(/.*) {
            proxy_cache_purge my_cache $scheme$request_method$host$1;
        }
    }
}

# Alternative: Manual cache clearing
# sudo rm -rf /var/cache/nginx/*
# sudo systemctl reload nginx

